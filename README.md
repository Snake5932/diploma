# Diploma

Для запуска потребуется:
* компьютер под управлением Ubuntu
* toolchain и SDK для ESP8266
* кабель USB-miniUSB
* один микроконтроллер ESP8266 для проверки прошивки, и два или более микроконтроллеров для проверки работы сети

## Инструкция по настройке среды для запуска и прошивке

## Инструкция к функциям клиента

### Конфигурация

Сначала необходимо настроить конфигурацию клиента. Для этого в файле config.h должны быть определены следующие параметры:

```с
#define BROADCAST_IP "192.168.2.255"
#define AP_IP "192.168.2.10"
#define NETMASK "255.255.255.0"
#define SSID "boromir-1"
#define SSID_PREFIX "boromir"
#define WIFI_PASS "111111111"
#define MAX_AP_CONN 1
#define PORT 5555
#define ORDER 10
#define RAND_SEED 234534862
```

* Значения PORT, WIFI_PASS, SSID_PREFIX должны быть одинаковыми для всех микроконтроллеров.
* AP_IP - адрес точки доступа данного микроконтроллера, NETMASK определяет маску, с помощью чего можно вычислить адрес сети,
адрес сети должен быть уникальным для каждого микроконтроллера. Соответсвенно BROADCAST_IP - широковещательный адрес в этой сети.
* SSID - определяет SSID точки доступа, оно же ID узла.
* ORDER - порядок узла в сети, уникален для каждого узла.
* RAND_SEED - случайное число для инициализации генератора случайных чисел, уникальное для каждого узла.
* MAX_AP_CONN - максимальное число клиентов точки доступа, от 1 до 4.

### Функции клиента

Для работы с клиентом используются следующие функции:

```c
struct boromir_client* new_boromir_client(uint32_t roles);

void start_client(struct boromir_client* client);

void send_msg(struct boromir_client* client, uint8_t* data, uint8_t data_len, uint32_t role, char* dest_name, int dest_name_len);

void set_callback(struct boromir_client* client, boromir_event_handler_t event_handler, void* usr);

void free_boromir_client(struct boromir_client* client);
```

где boromir_event_handler определяется как:

```c
typedef void (*boromir_event_handler_t)(void* usr, void* event_data, uint8_t data_len);
```

* функция new_boromir_client принимает на вход список ролей данного клиента и возвращает указатель на экземпляр клиента
* функция set_callback позволяет определить обработчик входящих сообщений, она принимает на вход указатель на клиент,
функцию-обработчик и указатель на пользовательские данные
* функция start_client запускает работы клиента
* функция send_msg позволяет отправить сообщение, на вход она принимает указатель на клиент, данные для передачи и их длину,
а также роль получателя или его ID, при этом роль имеет приоритет перед ID, и для его использования значение роли должно быть равно нулю.
Также должна передаваться лишь одна роль, в случае если в переменной роли в 1 установлены несколько бит, сообщение может не дойти до получателя
* функция free_boromir_client позволяет освободить память

Пример использования клиента есть в файле main.c.
